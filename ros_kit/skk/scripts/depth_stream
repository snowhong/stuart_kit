#!/usr/bin/env python
import os
import sys
import ctypes
import cv2
import numpy as np
from primesense import openni2
from primesense import _openni2 as c_api
from primesense import nite2
import matplotlib.pyplot as plt

#Initialized OpenNI
openni2.initialize() 
status = openni2.is_initialized()
if status:
    print 'OpenNI2 Initialization Done !'
else:
    print 'OpenNI2 Initialization Failed !'

#Open Device
dev = openni2.Device.open_any()


depth_stream = dev.create_depth_stream()

print 'device info:',dev.get_device_info()
print 'rgb video mode:', depth_stream.get_video_mode() 


depth_stream.start()

depth_frame = depth_stream.read_frame()
depth_frame_data = depth_frame.get_buffer_as_uint16()

while(1):
    depth_array = np.ndarray((depth_frame.height,depth_frame.width),dtype=np.uint16,buffer=depth_frame_data) 
    plt.imshow(depth_array)
    plt.show()
openni2.unload()

